<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìƒì¼ ì¶•í•˜ ë©”ì‹œì§€ ë¦¬ë·°</title>

  <!-- Firebase SDK (v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    body {
      background: #354;
      color: #fff;
      font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      text-align: center;
      padding: 40px;
    }

    h2 {
      margin-bottom: 10px;
    }

    #counter {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .card {
      background: #fff;
      color: #000;
      border-radius: 20px;
      padding: 40px;
      max-width: 520px;
      margin: 20px auto;
      font-size: 24px;
      line-height: 1.5;
      position: relative;
    }

    .nickname {
      font-size: 15px;
      color: #777;
      margin-bottom: 14px;
    }

    .controls {
      margin-top: 20px;
    }

    .controls button {
      margin: 0 8px;
      padding: 10px 20px;
      font-size: 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    #speak {
      background: #00c6ff;
      color: #000;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>ğŸ‚ ìƒì¼ ì¶•í•˜ ë©”ì‹œì§€</h2>
  <div id="counter"></div>

  <div class="card">
    <div class="nickname" id="nicknameText"></div>
    <p id="messageText">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>

  <div class="controls">
    <button id="prev">ì´ì „</button>
    <button id="speak">ğŸ”Š ìŒì„± ì¶œë ¥</button>
    <button id="next">ë‹¤ìŒ</button>
  </div>

  <script>
    /***** Firebase ì„¤ì • *****/
    const firebaseConfig = {
      apiKey: "AIzaSyDtDtadwFVoYMSahJyeNKqh-3NfwSagi-o",
      authDomain: "eunbin-4ba29.firebaseapp.com",
      projectId: "eunbin-4ba29",
      storageBucket: "eunbin-4ba29.firebasestorage.app",
      messagingSenderId: "1042774764206",
      appId: "1:1042774764206:web:1068894ff8f3c583ef5b3f",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /***** ìƒíƒœ *****/
    let messages = [];
    let index = 0;

    const messageEl = document.getElementById("messageText");
    const nicknameEl = document.getElementById("nicknameText");
    const counterEl = document.getElementById("counter");

    /***** ğŸ”¥ ìƒì¼ ë©”ì‹œì§€ ë¶ˆëŸ¬ì˜¤ê¸° *****/
    db.collection("birthday_messages")
      .where("approved", "==", true)
      .orderBy("order", "asc")
      .onSnapshot(snapshot => {
        messages = snapshot.docs.map(doc => doc.data());
        index = 0;
        render();
      });

    /***** í™”ë©´ ë Œë” *****/
    function render() {
      if (messages.length === 0) {
        messageEl.innerText = "í‘œì‹œí•  ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
        nicknameEl.innerText = "";
        counterEl.innerText = "";
        return;
      }

      const current = messages[index];
      messageEl.innerText = current.message;
      nicknameEl.innerText = `from. ${current.nickname || "ìµëª…"}`;
      counterEl.innerText = `${index + 1} / ${messages.length}`;
    }

    /***** ë²„íŠ¼ *****/
    document.getElementById("prev").onclick = () => {
      if (index > 0) {
        index--;
        render();
      }
    };

    document.getElementById("next").onclick = () => {
      if (index < messages.length - 1) {
        index++;
        render();
      }
    };

    /***** ğŸ”Š ìŒì„± ì¶œë ¥ (ë©”ì‹œì§€ë§Œ) *****/
    document.getElementById("speak").onclick = () => {
      if (!messages[index]) return;

      const u = new SpeechSynthesisUtterance(messages[index].message);
      u.lang = "ko-KR";
      u.rate = 1.15;
      u.pitch = 1.2;
      u.volume = 1;

      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    };
  </script>

</body>
</html>
